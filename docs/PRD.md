# Gemini-Codex 웹 양자 토론 시뮬레이터 PRD

## 1. 문서 개요
- 문서 목적: Gemini CLI와 Codex CLI의 상호 토론 과정을 웹에서 시각적으로 확인하고 제어할 수 있는 제품 요구사항 정의
- 대상 독자: PM, 디자이너, 프론트엔드/백엔드 엔지니어, QA
- 기준 버전: v1 (단일 사용자 로컬 실행 기준)

## 2. 제품 배경
- CLI 기반 멀티 에이전트 토론은 실행/관찰/제어가 어렵고, 상태 파악이 느리다.
- 특히 라운드 진행, 에이전트 방향 전환, 세션 상태, 오류 원인을 한 화면에서 확인하기 어렵다.
- 제품은 이 과정을 3패널 UI로 단순화해 실험 속도를 높인다.

## 3. 목표
- 사용자가 주제를 입력하고 1클릭으로 양자 토론을 시작할 수 있어야 한다.
- 토론 진행 상태(누가 누구에게 말하는지)를 실시간으로 명확히 보여야 한다.
- 연결/일시정지/재개/중지 등 제어 기능을 안정적으로 제공해야 한다.
- 실행 로그를 파일로 남겨 사후 분석이 가능해야 한다.

## 4. 비목표(Out of Scope)
- 멀티 사용자/권한 관리
- SaaS 배포/운영 대시보드
- UI에서 CLI 실행 커맨드 편집
- 비용/사용량 과금 기능

## 5. 핵심 사용자 시나리오
1. 사용자가 웹에 접속한다.
2. `Gemini 구동/재연결`, `Codex 구동/재연결`을 눌러 세션을 준비한다.
3. 토론 주제를 입력하고 `토론 시작`을 누른다.
4. 중앙 패널에서 라운드별 방향(`CODEx -> GEMINI`, `GEMINI -> CODEX`)을 확인한다.
5. 필요 시 `일시정지/재개/중지`를 수행한다.
6. 실행 후 `logs/runs/*` 로그로 토론 내용을 재검토한다.

## 6. 기능 요구사항

### 6.1 화면 구성
- 상단 컨트롤 바:
  - 주제 입력
  - 최대 턴 입력
  - 토론 시작/일시정지/재개/중지 버튼
  - 현재 상태, 라운드, runId 표시
- 본문 3패널:
  - 좌측: Gemini 터미널
  - 중앙: 토론 중계 터미널
  - 우측: Codex 터미널
- 하단 에이전트 바:
  - Gemini 구동/재연결 버튼 + 세션 상태
  - Codex 구동/재연결 버튼 + 세션 상태

### 6.2 토론 실행 규칙
- 시작 방향은 Codex 우선
- 기본 흐름: Codex -> Gemini -> Codex ...
- 종료 조건:
  - 합의 키워드 감지 또는
  - 최대 턴 도달
- 일시정지:
  - 현재 턴 완료 후 정지(턴 경계 정지)

### 6.3 상태/오류 표시
- 에이전트 상태: idle/connecting/ready/error
- 토론 상태: idle/running/pause_requested/paused/stopping/stopped/completed
- WebSocket 오류 발생 시 배너로 안내하고 자동 재연결 시도

### 6.4 기록 저장
- 세션: `logs/sessions.json`
- 토론 로그: `logs/runs/<runId>.jsonl`
- 요약: `logs/runs/<runId>.summary.json`

## 7. 사용성 요구사항
- 사용자가 라운드/방향 전환을 빠르게 인지할 수 있어야 한다.
- 중앙 패널의 로그는 라운드 구분선, 턴 슬롯 표기, 방향 화살표로 식별 가능해야 한다.
- Gemini 연결이 느릴 수 있으므로 연결 진행 상태를 즉시 보여야 한다.

## 8. 비기능 요구사항
- 신뢰성: CLI 오류 발생 시 앱이 비정상 종료되지 않고 상태를 에러로 전이
- 반응성: 버튼 입력 후 즉시 상태 반영(WS 미수신 시에도 API 응답 반영)
- 보안: `.env` 템플릿 placeholder 치환 시 shell quote 적용
- 관찰성: 서버 로그와 파일 로그를 통해 재현 가능한 수준의 실행 기록 보존

## 9. 성공 기준
- 토론 시작 전/중/후 주요 상태가 UI에 일관되게 표시된다.
- `connect -> start -> pause/resume/stop -> complete/stopped` 흐름이 동작한다.
- run 로그와 summary 파일이 생성된다.
- 사용자가 중앙 패널만 보고도 현재 라운드/방향을 이해할 수 있다.

## 10. 리스크 및 대응
- Gemini 응답 지연: 연결 상태를 `connecting`으로 즉시 표시하고 사용자에게 대기 인지 제공
- WebSocket 단절: 자동 재연결 + API 응답 기반 상태 보강
- Codex resume 제약: 환경 제약 시 fallback 경로를 제공해 실행 연속성 확보

## 11. 향후 개선
- 실시간 지연 시간(턴별 latency) 시각화
- 라운드별 토글/필터링 UI
- 에이전트별 모델/프롬프트 전략 프리셋
